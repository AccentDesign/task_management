{% extends 'base.html' %}
{% load i18n static %}
{% block page_title %}Jobs{% endblock %}
{% block body_class %}{% endblock %}
{% block inner_content %}
    <div class="page-header py-2">
        <div class="container d-flex align-items-center">
            <span class="color-indicator" style="background: {{ object.colour }}"></span>
            <div class="h2">
                <b>{{ object.pk }}</b> :
                <a href="{{ object.client.get_absolute_url }}">{{ object.client.name }}</a> /
                <a href="{{ object.get_absolute_url }}">{{ object.title }}</a>
            </div>
            <div class="page-header-actions">
                <a class="button button-white" href="{{ object.get_update_url }}">{% trans 'Edit' %}</a>
                <a class="button button-white button-clear" href="{% url 'wip:job-delete' object.pk %}">{% trans 'Delete' %} <i class="icon-trash"></i></a>
            </div>
        </div>
    </div>
    <div class="container inner-content">
        <div class="row">
            <div class="col">
                <p class="strong">{% trans 'Description' %}</p>
                {{ object.description|default:'-'|linebreaks }}
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6 col-xl-3">
                <div class="panel text-center">
                    <p class="strong">{% trans 'Time Spent (hours)' %}</p>
                    <p>-</p>
                </div>
            </div>
            <div class="col-lg-6 col-xl-3">
                <div class="panel text-center">
                    <p class="strong">{% trans 'Type' %}</p>
                    <p>{{ object.type }}</p>
                </div>
            </div>
            <div class="col-lg-6 col-xl-3">
                <div class="panel text-center">
                    <p class="strong">{% trans 'Status' %}</p>
                    <p>{{ object.status }}</p>
                </div>
            </div>
            <div class="col-lg-6 col-xl-3">
                <div class="panel text-center">
                    <p class="strong">{% trans 'Billed To' %}</p>
                    <p>{{ object.billed_to|date:'d/m/Y'|default:'-' }}</p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <ul class="tabs">
                    <li data-tab-id="tasks" class="active">{% trans 'Tasks' %}</li>
                    <li data-tab-id="relationships">{% trans 'Relationships' %}</li>
                    <li data-tab-id="recurring_costs">{% trans 'Recurring Costs' %}</li>
                    <li data-tab-id="notes">{% trans 'Notes' %}</li>
                </ul>
                <div class="panel">
                    <div data-tab="tasks">
                        <div class="panel-actions">
                            <a class="button button-primary" href="{% url 'wip:task-create' object.pk %}">{% trans 'Add' %}</a>
                        </div>
                        <table class="table-hover table-headed margin-zero">
                            <thead>
                                <tr>
                                    <th>{% trans 'Title' %}</th>
                                    <th class="keep-min-width">{% trans 'Status' %}</th>
                                    <th class="keep-min-width">{% trans 'Allocated Hours' %}</th>
                                    <th class="keep-min-width">{% trans 'Time Spent' %}</th>
                                    <th class="keep-min-width">{% trans 'Target Date' %}</th>
                                    <th class="keep-min-width">{% trans 'Closed' %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for task in object.tasks.all %}
                                <tr data-url="{{ task.get_absolute_url }}">
                                    <td>{{ task.title }}</td>
                                    <td class="keep-min-width">{{ task.status }}</td>
                                    <td class="keep-min-width">{{ task.allocated_hours }}</td>
                                    <td class="keep-min-width">-</td>
                                    <td class="keep-min-width">{{ task.target_date|date:'d/m/Y'|default:'-' }}</td>
                                    <td class="keep-min-width">{{ task.closed|yesno:'Yes,-,-' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div data-tab="relationships" class="d-hidden">
                        <table class="table-hover table-headed margin-zero">
                            <thead>
                                <tr>
                                    <th>{% trans 'User' %}</th>
                                    <th>{% trans 'Relationship' %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for relationship in object.relationships.all %}
                                <tr>
                                    <td>{{ relationship.user.get_full_name }}</td>
                                    <td>{{ relationship.relationship }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div data-tab="recurring_costs" class="d-hidden">
                        <table class="table-hover table-headed margin-zero">
                            <thead>
                                <tr>
                                    <th>{% trans 'Type' %}</th>
                                    <th>{% trans 'Last Invoiced Date' %}</th>
                                    <th>{% trans 'Billing Frequency' %}</th>
                                    <th>{% trans 'Payment Option' %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for cost in object.recurring_costs.all %}
                                <tr>
                                    <td>{{ cost.type }}</td>
                                    <td>{{ cost.last_invoiced_date|date:'d/m/Y'|default:'-' }}</td>
                                    <td>{{ cost.billing_frequency_text }}</td>
                                    <td>{{ cost.payment_option }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div data-tab="notes" class="d-hidden">
                        <div class="panel-actions">
                            <a class="button button-primary" href="{% url 'wip:jobnote-create' object.pk %}">{% trans 'Add' %}</a>
                        </div>
                        {% for note in object.notes.all %}
                            <p>{{ note.user.get_full_name }} - {{ note.created_at }}</p>
                            <div class="comment">{{ note.note|linebreaks }}</td></div>
                            <a href="{{ note.get_update_url }}">{% trans 'Edit' %}</a> | <a href="{% url 'wip:jobnote-delete' note.pk %}">{% trans 'Delete' %}</a>
                            {% if not forloop.last %}<hr>{% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block extra_js %}
    <script src="{% static 'dist/js/tabs.js' %}"></script>
    <script>$('.tabs').tabs();</script>
{% endblock %}